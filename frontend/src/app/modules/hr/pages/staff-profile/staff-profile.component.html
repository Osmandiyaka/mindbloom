<div class="profile-page">
  <header class="page-header">
    <div>
      <p class="eyebrow">HR · Profile</p>
      <h1>{{ displayName(staff()) || 'Loading...' }}</h1>
      <p class="muted">Manage staff profile details and supporting documents.</p>
    </div>
    <div class="header-actions">
      <app-button variant="secondary" size="sm" (click)="backToDirectory()">Back to Directory</app-button>
      <app-button variant="primary" size="sm" (click)="saveForms()" [disabled]="saving()">Save Changes</app-button>
    </div>
  </header>

  <div class="toast" *ngIf="toast() as t" [class.success]="t.type === 'success'" [class.error]="t.type === 'error'">
    {{ t.message }}
  </div>

  <div class="content-grid" *ngIf="!loading(); else loadingState">
    <app-card class="summary-card">
      <div class="summary-top">
        <div class="avatar">
          {{ (displayName(staff()) || '?') | slice:0:2 | uppercase }}
        </div>
        <div class="summary-info">
          <h3>{{ displayName(staff()) }}</h3>
          <p class="muted">Staff Code {{ staff()?.staffCode || '—' }}</p>
          <span class="pill status">{{ staff()?.status || 'active' }}</span>
        </div>
      </div>
      <div class="summary-meta">
        <div><p class="label">Preferred Name</p><p class="value">{{ staff()?.preferredName || '-' }}</p></div>
        <div><p class="label">Date of Birth</p><p class="value">{{ staff()?.dob || '-' }}</p></div>
        <div><p class="label">Gender</p><p class="value">{{ staff()?.gender || '-' }}</p></div>
        <div><p class="label">Nationality</p><p class="value">{{ staff()?.nationality || '-' }}</p></div>
      </div>
    </app-card>

    <app-card class="tabs-card">
      <nav class="tabs">
        <button type="button" [class.active]="activeTab() === 'overview'" (click)="setTab('overview')">Overview</button>
        <button type="button" [class.active]="activeTab() === 'docs'" (click)="setTab('docs')">Documents</button>
      </nav>

      <section class="tab-panel" *ngIf="activeTab() === 'overview'">
        <form [formGroup]="personalForm" class="form-grid">
          <label>Staff Code
            <input formControlName="staffCode" />
            <span class="error" *ngIf="controlInvalid(personalForm, 'staffCode')">Staff code is required.</span>
          </label>
          <label>First Name
            <input formControlName="firstName" />
            <span class="error" *ngIf="controlInvalid(personalForm, 'firstName')">First name is required.</span>
          </label>
          <label>Last Name
            <input formControlName="lastName" />
            <span class="error" *ngIf="controlInvalid(personalForm, 'lastName')">Last name is required.</span>
          </label>
          <label>Preferred Name
            <input formControlName="preferredName" />
          </label>
          <label>Date of Birth
            <input type="date" formControlName="dob" />
          </label>
          <label>Gender
            <input formControlName="gender" />
          </label>
          <label>Nationality
            <input formControlName="nationality" />
          </label>
          <label>Status
            <select formControlName="status">
              <option value="draft">Draft</option>
              <option value="pending">Pending</option>
              <option value="active">Active</option>
              <option value="onLeave">On Leave</option>
              <option value="suspended">Suspended</option>
              <option value="archived">Archived</option>
              <option value="terminated">Terminated</option>
            </select>
          </label>
        </form>
      </section>

      <section class="tab-panel" *ngIf="activeTab() === 'docs'">
        <div class="docs-head">
          <div>
            <p class="strong">Documents</p>
            <p class="muted small">Upload contracts, IDs, certifications.</p>
          </div>
          <label class="upload-chip">
            <input type="file" (change)="uploadDoc($event)" multiple />
            Upload
          </label>
        </div>
        <div class="docs-list">
          <div class="doc-row" *ngFor="let doc of docs()">
            <div>
              <p class="strong">{{ doc.name }}</p>
              <p class="muted small">{{ doc.size }} · {{ doc.type }}</p>
              <div class="progress" *ngIf="doc.status === 'uploading'">
                <div class="bar" [style.width.%]="doc.progress || 0"></div>
              </div>
            </div>
            <div class="doc-actions">
              <span class="pill" [class.muted]="doc.status !== 'complete'">{{ doc.status }}</span>
              <button type="button" (click)="viewDoc(doc)">Preview</button>
              <button type="button" (click)="deleteDoc(doc.id)">Delete</button>
            </div>
          </div>
          <div *ngIf="!docs().length" class="muted">No documents uploaded.</div>
        </div>
      </section>

    </app-card>
  </div>

  <ng-template #loadingState>
    <div class="skeleton-card">
      <div class="skeleton-line wide"></div>
      <div class="skeleton-line"></div>
      <div class="skeleton-line"></div>
    </div>
  </ng-template>
</div>
