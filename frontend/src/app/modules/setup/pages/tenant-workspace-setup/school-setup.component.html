<div class="setup-body" id="setup-step-content">
    <div class="setup-section">
        <h2>Schools</h2>
        <p>Manage the schools under your organization. You can add, edit, or deactivate schools
            at any time.</p>

        <div class="schools-grid">
            <div class="schools-table-wrap">
                <div class="schools-table__titlebar">
                    <div class="schools-table__title">Schools</div>
                    <mb-button variant="primary" (click)="openAddSchool()">+ Add
                        school</mb-button>
                </div>
                <div class="setup-error" *ngIf="errorMessage()">{{ errorMessage() }}</div>
                <mb-table class="schools-table" *ngIf="schoolRows().length; else emptySchools"
                    [columns]="schoolTableColumns" [rows]="schoolRows()">
                    <ng-template mbTableActions let-row>
                        <div class="schools-table__actions">
                            <button type="button" class="schools-menu__toggle" #schoolMenuOrigin
                                aria-label="Actions"
                                [attr.aria-expanded]="schoolMenuOpenId() === schoolMenuKey(row)"
                                (click)="toggleSchoolMenu(row, $event)">⋯</button>
                            <mb-popover [open]="schoolMenuOpenId() === schoolMenuKey(row)"
                                [origin]="schoolMenuOrigin" [hasBackdrop]="true"
                                [panelClass]="['mb-popover-panel', 'mb-popover-panel--above-modal', 'schools-menu__panel']"
                                (closed)="closeSchoolMenu()">
                                <div class="schools-menu__panel-content" role="menu">
                                    <button type="button" class="schools-menu__item"
                                        (click)="openEditSchool(row); closeSchoolMenu()">
                                        Update
                                    </button>
                                    <button type="button" class="schools-menu__item"
                                        (click)="cloneSchool(row); closeSchoolMenu()">
                                        Clone
                                    </button>
                                    <button type="button" class="schools-menu__item"
                                        (click)="archiveSchool(row); closeSchoolMenu()">
                                        Archive
                                    </button>
                                    <button type="button"
                                        class="schools-menu__item schools-menu__item--danger"
                                        (click)="deleteSchool(row); closeSchoolMenu()">
                                        Delete
                                    </button>
                                </div>
                            </mb-popover>
                        </div>
                    </ng-template>
                </mb-table>

                <ng-template #emptySchools>
                    <div class="schools-empty">
                        <div class="schools-empty__icon" aria-hidden="true">
                            <svg viewBox="0 0 24 24" role="img" focusable="false">
                                <path
                                    d="M4 10.5l8-5 8 5v8.5a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1v-8.5Z"
                                    fill="none" stroke="currentColor" stroke-width="1.5"
                                    stroke-linejoin="round" />
                                <path d="M9 20v-6h6v6" fill="none" stroke="currentColor"
                                    stroke-width="1.5" stroke-linecap="round" />
                            </svg>
                        </div>
                        <div class="schools-empty__title">No schools added yet</div>
                        <div class="schools-empty__text">
                            Add your first school to continue setup.
                        </div>
                        <mb-button variant="primary" (click)="openAddSchool()">+ Add
                            school</mb-button>
                    </div>
                </ng-template>
            </div>
        </div>
        <div class="schools-modal" *ngIf="isSchoolModalOpen()" role="presentation">
            <div class="schools-modal__backdrop"></div>
            <div class="schools-modal__dialog" role="dialog" aria-modal="true"
                aria-labelledby="school-modal-title" tabindex="0"
                (keydown.escape)="closeSchoolModal()">
                <div class="schools-modal__header">
                    <div>
                        <div id="school-modal-title" class="schools-modal__title">
                            Add school
                        </div>
                        <div class="schools-modal__subtitle">
                            Add a school to your organization. You can update details later.
                        </div>
                    </div>
                    <button type="button" class="schools-modal__close"
                        (click)="closeSchoolModal()" aria-label="Close dialog">×</button>
                </div>
                <div class="schools-modal__body">
                    <div class="schools-modal__section">
                        <div class="schools-modal__section-title">Identity</div>
                        <mb-form-field label="School name" [controlId]="'school-form-name'"
                            hint="This is the name shown across the platform."
                            [error]="schoolFormTouched() && !schoolFormName().trim() ? 'School name is required.' : ''">
                            <mb-input id="school-form-name" [value]="schoolFormName()"
                                (valueChange)="onSchoolFormNameChange($event)"
                                (blur)="markSchoolFormTouched()"></mb-input>
                        </mb-form-field>

                        <mb-form-field label="School code" [controlId]="'school-form-code'"
                            hint="Used internally for identifiers and integrations."
                            [error]="schoolFormCodeError()">
                            <mb-input id="school-form-code" [value]="schoolFormCode()"
                                (valueChange)="onSchoolFormCodeChange($event)"
                                (blur)="markSchoolFormTouched()"></mb-input>
                        </mb-form-field>
                    </div>

                    <div class="schools-modal__section">
                        <div class="schools-modal__section-title">Location & time</div>
                        <mb-form-field label="Country or region"
                            [controlId]="'school-form-country'"
                            [error]="schoolFormCountryError()">
                            <app-country-select id="school-form-country"
                                [value]="schoolFormCountry()"
                                (valueChange)="onSchoolFormCountryChange($event)"
                                (blurEvent)="markSchoolFormTouched()"></app-country-select>
                        </mb-form-field>

                        <app-address [value]="schoolFormAddress()"
                            [showCopy]="!!tenantAddress()"
                            [copyLabel]="'Copy from organization'" [title]="'Address'"
                            [controlPrefix]="'school-form-address'"
                            (valueChange)="onSchoolFormAddressChange($event)"
                            (copyFromTenant)="copySchoolAddressFromTenant()"></app-address>

                        <mb-form-field label="Time zone" [controlId]="'school-form-timezone'"
                            hint="Used for schedules, attendance, and reports."
                            [error]="schoolFormTimezoneError()">
                            <app-timezone-select id="school-form-timezone"
                                [value]="schoolFormTimezone()"
                                (valueChange)="onSchoolFormTimezoneChange($event)"
                                (blurEvent)="markSchoolFormTouched()"></app-timezone-select>
                        </mb-form-field>
                    </div>
                </div>
                <div class="schools-modal__footer">
                    <div class="schools-modal__hint">Configuration changes are saved
                        automatically.</div>
                    <div class="schools-modal__actions">
                        <mb-button variant="secondary"
                            (click)="closeSchoolModal()">Cancel</mb-button>
                        <mb-button variant="primary" [disabled]="!canSaveSchool() || isSaving()"
                            (click)="saveSchool()">
                            {{ isSaving() ? 'Saving...' : 'Add school' }}
                        </mb-button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
