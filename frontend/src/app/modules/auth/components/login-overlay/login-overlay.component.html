<div class="login-card">
    <!-- Left Brand Panel -->
    <div class="brand-panel">
        <div class="brand-content">
            <h1 class="brand-title">MindBloom</h1>
            <p class="brand-subtitle">The operating system for modern schools.</p>
            <p class="brand-meta">Admissions, academics, finance, and administration â€” unified.</p>

            <div class="brand-illustration" aria-hidden="true">
                <svg viewBox="0 0 240 200" xmlns="http://www.w3.org/2000/svg">
                    <g class="school-os">
                        <g class="core">
                            <circle cx="120" cy="102" r="20" class="core-node" />
                            <circle cx="120" cy="102" r="28" class="core-ring" />
                            <circle cx="120" cy="102" r="46" class="core-glow" />
                        </g>

                        <g class="connectors">
                            <path d="M120 78 L120 48" class="connector" />
                            <path d="M120 126 L120 156" class="connector" />
                            <path d="M104 92 L62 70" class="connector" />
                            <path d="M136 92 L178 68" class="connector" />
                            <path d="M104 118 L62 140" class="connector" />
                            <path d="M136 118 L178 142" class="connector" />
                        </g>

                        <g class="module admissions" transform="translate(60 36)">
                            <rect width="82" height="36" rx="12" class="module-card" />
                            <circle cx="18" cy="18" r="7" class="module-icon" />
                            <text x="34" y="22" class="module-label">Admissions</text>
                        </g>

                        <g class="module academics" transform="translate(136 26)">
                            <rect width="82" height="36" rx="12" class="module-card" />
                            <circle cx="18" cy="18" r="7" class="module-icon" />
                            <text x="34" y="22" class="module-label">Academics</text>
                        </g>

                        <g class="module finance" transform="translate(50 136)">
                            <rect width="84" height="36" rx="12" class="module-card" />
                            <circle cx="18" cy="18" r="7" class="module-icon" />
                            <text x="34" y="22" class="module-label">Finance</text>
                        </g>

                        <g class="module admin" transform="translate(146 136)">
                            <rect width="86" height="36" rx="12" class="module-card" />
                            <circle cx="18" cy="18" r="7" class="module-icon" />
                            <text x="34" y="22" class="module-label">Admin</text>
                        </g>
                    </g>
                </svg>
            </div>

            <p class="brand-trust">Secure | Multi-tenant | Role-based access</p>
        </div>
    </div>

    <!-- Right Login Panel -->
    <div class="login-panel">
        <h2 class="welcome-title">Welcome to MindBloom</h2>

        <form (ngSubmit)="onSubmit()" class="login-form">
            <div class="mode-switch" role="tablist" aria-label="Login mode">
                <button type="button" class="mode-pill" [class.active]="loginMode() === 'tenant'"
                    (click)="setMode('tenant')" role="tab" [attr.aria-selected]="loginMode() === 'tenant'">
                    School admin
                </button>
                <button type="button" class="mode-pill" [class.active]="loginMode() === 'host'"
                    (click)="setMode('host')" role="tab" [attr.aria-selected]="loginMode() === 'host'">
                    Host
                </button>
            </div>

            <!-- School Code -->
            @if (loginMode() === 'tenant') {
            @if (!isEditingTenant()) {
            <div class="tenant-context" aria-live="polite">
                <div class="tenant-context__label">Signing in to</div>
                <div class="tenant-context__row">
                    <span class="tenant-chip" aria-label="Selected tenant">
                        <span class="tenant-chip__icon" aria-hidden="true">
                            <svg viewBox="0 0 20 20" width="14" height="14" focusable="false">
                                <path d="M10 2.5 4 4.6v4.9c0 3.1 2.45 5.82 6 6.9 3.55-1.08 6-3.8 6-6.9V4.6L10 2.5Z"
                                    stroke="currentColor" stroke-width="1.4" fill="none" stroke-linejoin="round" />
                                <path d="M7.2 9.8 9 11.6 13 7.6" stroke="currentColor" stroke-width="1.6" fill="none"
                                    stroke-linecap="round" stroke-linejoin="round" />
                            </svg>
                        </span>
                        <span class="tenant-chip__text">{{ currentTenant }}</span>
                    </span>
                    <button type="button" class="tenant-context__change" (click)="onChangeTenant()">Change</button>
                </div>
            </div>
            } @else {
            <div class="form-group">
                <label class="form-label">School Code</label>
                <div class="tenant-field">
                    <!-- EDIT MODE -->
                    <div class="input-wrapper tenant-edit-wrapper">
                        <svg class="input-icon" width="16" height="16" viewBox="0 0 16 16" fill="none">
                            <path
                                d="M2 6L8 2L14 6V13C14 13.5304 13.7893 14.0391 13.4142 14.4142C13.0391 14.7893 12.5304 15 12 15H4C3.46957 15 2.96086 14.7893 2.58579 14.4142C2.21071 14.0391 2 13.5304 2 13V6Z"
                                stroke="currentColor" stroke-width="1.5" stroke-linecap="round"
                                stroke-linejoin="round" />
                        </svg>
                        <input type="text" class="form-input tenant-edit-input" [value]="tenantEditValue()"
                            (input)="tenantEditValue.set($any($event.target).value)" (keydown)="onTenantKeyDown($event)"
                            placeholder="Enter school code" [disabled]="isValidatingTenant()" />
                    </div>
                    <button type="button" class="action-btn save-btn" (click)="onSaveTenant()"
                        [disabled]="!tenantEditValue().trim() || isValidatingTenant()" title="Save (Enter)">
                        @if (isValidatingTenant()) {
                        <svg class="spinner" width="14" height="14" viewBox="0 0 24 24" fill="none">
                            <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="3" stroke-linecap="round"
                                stroke-dasharray="31.4 31.4" stroke-dashoffset="0">
                                <animateTransform attributeName="transform" type="rotate" from="0 12 12" to="360 12 12"
                                    dur="1s" repeatCount="indefinite" />
                            </circle>
                        </svg>
                        } @else {
                        <svg width="14" height="14" viewBox="0 0 16 16" fill="none">
                            <path d="M13.3333 4L6 11.3333L2.66666 8" stroke="currentColor" stroke-width="2"
                                stroke-linecap="round" stroke-linejoin="round" />
                        </svg>
                        }
                    </button>
                    <button type="button" class="action-btn cancel-btn" (click)="onCancelTenantEdit()"
                        [disabled]="isValidatingTenant()" title="Cancel (Esc)">
                        <svg width="14" height="14" viewBox="0 0 16 16" fill="none">
                            <path d="M12 4L4 12M4 4L12 12" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round" />
                        </svg>
                    </button>
                </div>
                @if (tenantErrorMessage()) {
                <p class="tenant-error">{{ tenantErrorMessage() }}</p>
                }
                <p class="form-help">
                    Enter your school code to continue.
                    <a href="#" class="register-link" (click)="onRegisterTenant($event)">Register new school</a>
                </p>
            </div>
            }
            } @else {
            <div class="form-group">
                <label class="form-label">Host login</label>
                <p class="form-help">Host admins can sign in without selecting a school.</p>
            </div>
            }

            <!-- Username -->
            <div class="form-group">
                <label class="form-label">Email or username</label>
                <div class="input-wrapper">
                    <svg class="input-icon" width="16" height="16" viewBox="0 0 16 16" fill="none">
                        <path
                            d="M13 14V12.6667C13 11.9594 12.719 11.2811 12.219 10.781C11.7189 10.281 11.0406 10 10.3333 10H5.66667C4.95942 10 4.28115 10.281 3.78105 10.781C3.28095 11.2811 3 11.9594 3 12.6667V14M10.6667 4.66667C10.6667 6.13943 9.47276 7.33333 8 7.33333C6.52724 7.33333 5.33333 6.13943 5.33333 4.66667C5.33333 3.19391 6.52724 2 8 2C9.47276 2 10.6667 3.19391 10.6667 4.66667Z"
                            stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
                    </svg>
                    <input type="text" class="form-input" placeholder="admin" [value]="username()"
                        (input)="username.set($any($event.target).value)" required />
                </div>
            </div>

            <!-- Password -->
            <div class="form-group">
                <div class="form-label-row">
                    <label class="form-label">Password</label>
                    <a class="link-btn" routerLink="/auth/forgot">Forgot password</a>
                </div>
                <div class="input-wrapper">
                    <svg class="input-icon" width="16" height="16" viewBox="0 0 16 16" fill="none">
                        <path
                            d="M12.6667 7.33333H3.33333C2.59695 7.33333 2 7.93029 2 8.66667V13.3333C2 14.0697 2.59695 14.6667 3.33333 14.6667H12.6667C13.403 14.6667 14 14.0697 14 13.3333V8.66667C14 7.93029 13.403 7.33333 12.6667 7.33333Z"
                            stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
                        <path
                            d="M4.66675 7.33333V4.66667C4.66675 3.78261 5.01794 2.93477 5.64306 2.30964C6.26818 1.68452 7.11603 1.33333 8.00008 1.33333C8.88414 1.33333 9.73198 1.68452 10.3571 2.30964C10.9822 2.93477 11.3334 3.78261 11.3334 4.66667V7.33333"
                            stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
                    </svg>
                    <input [type]="showPassword() ? 'text' : 'password'" class="form-input" [value]="password()"
                        (input)="password.set($any($event.target).value)" required />
                    <button type="button" class="input-toggle" (click)="togglePassword()"
                        aria-label="Toggle password visibility">
                        <svg *ngIf="!showPassword()" width="16" height="16" viewBox="0 0 16 16" fill="none">
                            <path
                                d="M1.333 8c1.4-2.8 3.733-4.333 6.667-4.333S13.267 5.2 14.667 8c-1.4 2.8-3.733 4.333-6.667 4.333S2.733 10.8 1.333 8Z"
                                stroke="currentColor" stroke-width="1.2" />
                            <circle cx="8" cy="8" r="2.2" stroke="currentColor" stroke-width="1.2" />
                        </svg>
                        <svg *ngIf="showPassword()" width="16" height="16" viewBox="0 0 16 16" fill="none">
                            <path d="M2 2l12 12" stroke="currentColor" stroke-width="1.2" stroke-linecap="round" />
                            <path
                                d="M3.2 4.1C1.9 5.2 1.067 6.6 1.333 8c1.4 2.8 3.733 4.333 6.667 4.333 1.06 0 2.04-.2 2.94-.6"
                                stroke="currentColor" stroke-width="1.2" stroke-linecap="round" />
                            <path d="M6.233 6.233A2.333 2.333 0 0 1 9.8 9.8" stroke="currentColor" stroke-width="1.2" />
                        </svg>
                    </button>
                </div>
            </div>

            <!-- Error Message -->
            @if (errorMessage()) {
            <div class="error-message">{{ errorMessage() }}</div>
            }
            @if (resetSuccess()) {
            <div class="success-message">Password reset successfully. Please sign in.</div>
            }

            <!-- Remember Me -->
            <div class="form-group remember-group">
                <label class="checkbox-chip">
                    <input type="checkbox" class="checkbox-input" [checked]="rememberMe()"
                        (change)="rememberMe.set($any($event.target).checked)" />
                    <span class="chip-icon" aria-hidden="true">
                        <svg width="14" height="14" viewBox="0 0 16 16" fill="none">
                            <path d="M13.3333 4L6 11.3333L2.66666 8" stroke="currentColor" stroke-width="2"
                                stroke-linecap="round" stroke-linejoin="round" />
                        </svg>
                    </span>
                    <span class="checkbox-text">Remember me</span>
                </label>
            </div>

            <!-- Sign In Button -->
            <button type="submit" class="signin-btn" [disabled]="isLoading()">
                {{ isLoading() ? 'Signing in...' : 'Sign in' }}
            </button>
        </form>
    </div>
</div>

<!-- Tenant Registration Modal -->
@if (showRegistration()) {
<app-tenant-registration (cancelled)="onRegistrationCancelled()"
    (registered)="onRegistrationCompleted($event)"></app-tenant-registration>
}