<div class="login-scene">
    <div class="background-layer" aria-hidden="true">
        <span class="orb orb-1"></span>
        <span class="orb orb-2"></span>
        <span class="orb orb-3"></span>
        <span class="orb orb-4"></span>
        <span class="shape square shape-1"></span>
        <span class="shape square shape-2"></span>
        <span class="shape circle shape-3"></span>
        <span class="shape circle shape-4"></span>
        <div class="wave">
            <svg viewBox="0 0 1440 160" preserveAspectRatio="none">
                <path fill="url(#waveGrad)" d="M0,64 C240,120 480,20 720,64 C960,108 1200,160 1440,96 L1440,160 L0,160 Z">
                    <animate attributeName="d" dur="10s" repeatCount="indefinite"
                        values="M0,64 C240,120 480,20 720,64 C960,108 1200,160 1440,96 L1440,160 L0,160 Z;
                                M0,96 C240,40 480,140 720,96 C960,52 1200,0 1440,64 L1440,160 L0,160 Z;
                                M0,64 C240,120 480,20 720,64 C960,108 1200,160 1440,96 L1440,160 L0,160 Z" />
                </path>
                <defs>
                    <linearGradient id="waveGrad" x1="0" y1="0" x2="1" y2="0">
                        <stop offset="0" stop-color="#ffffff" stop-opacity="0.2" />
                        <stop offset="0.5" stop-color="#ffffff" stop-opacity="0.05" />
                        <stop offset="1" stop-color="#ffffff" stop-opacity="0.2" />
                    </linearGradient>
                </defs>
            </svg>
        </div>
    </div>

    <div class="login-card">
        <div class="hero-panel" @heroStagger>
            <div class="brand-row hero-animate">
                <div class="logo-badge" aria-hidden="true">
                    <svg viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <circle cx="32" cy="32" r="30" fill="url(#gradLogo)" />
                        <path
                            d="M16 27L32 20l16 7v12.5c0 3.1-2.4 6.3-7.2 9.3-1.4.9-3.1 1.4-4.8 1.4-1.7 0-3.4-.5-4.8-1.4-4.8-3-7.2-6.2-7.2-9.3V27Z"
                            stroke="white" stroke-width="2.6" stroke-linejoin="round" fill="none" />
                        <path d="M23 33.5 31 40l10-10" stroke="white" stroke-width="2.6" stroke-linecap="round"
                            stroke-linejoin="round" />
                        <defs>
                            <linearGradient id="gradLogo" x1="10" y1="10" x2="52" y2="54"
                                gradientUnits="userSpaceOnUse">
                                <stop stop-color="#a855f7" />
                                <stop offset="1" stop-color="#ec4899" />
                            </linearGradient>
                        </defs>
                    </svg>
                </div>
                <div class="brand-text">
                    <div class="brand-name">EduManage</div>
                    <span class="brand-tag">School Management SaaS</span>
                </div>
            </div>

            <h1 class="hero-title hero-animate">Welcome to the <span>Future of Education</span></h1>
            <p class="hero-subtitle hero-animate">
                Streamline admissions, academics, finance, and community engagement with one intelligent platform.
            </p>

            <div class="stat-grid hero-animate" aria-label="Platform impact">
                <div class="stat-card">
                    <div class="stat-value">10K+</div>
                    <div class="stat-label">Students</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">500+</div>
                    <div class="stat-label">Schools</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">98%</div>
                    <div class="stat-label">Satisfaction</div>
                </div>
            </div>
        </div>

        <div class="auth-panel">
            <div class="login-shell">
                <div class="shell-header">
                    <h2 class="welcome-title">Welcome Back</h2>
                    <p class="welcome-subtitle">Sign in to continue to your dashboard</p>
                </div>

                <div class="mode-switch" role="tablist" aria-label="Login mode" [attr.data-active]="loginMode()">
                    <button type="button" class="mode-btn" [class.active]="loginMode() === 'tenant'"
                        (click)="setMode('tenant')" role="tab" [attr.aria-selected]="loginMode() === 'tenant'">
                        School Admin
                    </button>
                    <button type="button" class="mode-btn" [class.active]="loginMode() === 'host'"
                        (click)="setMode('host')" role="tab" [attr.aria-selected]="loginMode() === 'host'">
                        Host
                    </button>
                </div>

                @if (loginMode() === 'tenant') {
                @if (tenantStep() === 'select') {
                <div class="tenant-step" @stepFadeUp>
                    <div class="form-group">
                        <label class="form-label">School Code</label>
                        <div class="input-wrapper input-action">
                            <svg class="input-icon" width="16" height="16" viewBox="0 0 16 16" fill="none">
                                <path
                                    d="M2 6L8 2L14 6V13C14 13.5304 13.7893 14.0391 13.4142 14.4142C13.0391 14.7893 12.5304 15 12 15H4C3.46957 15 2.96086 14.7893 2.58579 14.4142C2.21071 14.0391 2 13.5304 2 13V6Z"
                                    stroke="currentColor" stroke-width="1.5" stroke-linecap="round"
                                    stroke-linejoin="round" />
                            </svg>
                            <input type="text" class="form-input" placeholder="Enter school code"
                                [value]="schoolCode()"
                                (input)="schoolCode.set($any($event.target).value); tenantErrorMessage.set('')"
                                (keydown)="onSchoolCodeKeyDown($event)" [disabled]="isValidatingTenant()" required />
                            <button type="button" class="input-action-btn" (click)="onConfirmTenant()"
                                [disabled]="!schoolCode().trim() || isValidatingTenant()" title="Confirm (Enter)">
                                @if (isValidatingTenant()) {
                                <svg class="spinner" width="14" height="14" viewBox="0 0 24 24" fill="none">
                                    <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="3"
                                        stroke-linecap="round" stroke-dasharray="31.4 31.4" stroke-dashoffset="0">
                                        <animateTransform attributeName="transform" type="rotate" from="0 12 12"
                                            to="360 12 12" dur="1s" repeatCount="indefinite" />
                                    </circle>
                                </svg>
                                } @else {
                                <svg width="14" height="14" viewBox="0 0 16 16" fill="none">
                                    <path d="M13.3333 4L6 11.3333L2.66666 8" stroke="currentColor" stroke-width="2"
                                        stroke-linecap="round" stroke-linejoin="round" />
                                </svg>
                                }
                            </button>
                        </div>
                        @if (tenantErrorMessage()) {
                        <p class="tenant-error">{{ tenantErrorMessage() }}</p>
                        }
                        <p class="form-help">
                            Enter your school code to continue.
                            <a href="#" class="register-link" (click)="onRegisterTenant($event)">Register new school</a>
                        </p>
                    </div>
                </div>
                } @else {
                <div class="tenant-step" @stepFadeUp>
                    @if (!isEditingTenant()) {
                    <div class="tenant-card" aria-live="polite">
                        <div class="tenant-icon" aria-hidden="true">
                            <svg viewBox="0 0 24 24" width="18" height="18" fill="none">
                                <rect x="5" y="7" width="14" height="11" rx="3" stroke="currentColor" stroke-width="1.5" />
                                <path d="M9 7V5h6v2" stroke="currentColor" stroke-width="1.5"
                                    stroke-linecap="round" />
                            </svg>
                        </div>
                        <div class="tenant-info">
                            <div class="tenant-label">SIGNING IN TO</div>
                            <div class="tenant-name">{{ currentTenant }}</div>
                            <div class="tenant-meta">Tenant Code: {{ currentTenantCode }}</div>
                        </div>
                        <button type="button" class="tenant-change" (click)="onChangeTenant()">
                            Change
                            <svg viewBox="0 0 16 16" width="14" height="14" aria-hidden="true">
                                <path d="M6 3.5 10.5 8 6 12.5" stroke="currentColor" stroke-width="1.6" fill="none"
                                    stroke-linecap="round" stroke-linejoin="round" />
                            </svg>
                        </button>
                    </div>
                    } @else {
                    <div class="form-group">
                        <label class="form-label">School Code</label>
                        <div class="tenant-field">
                            <div class="input-wrapper tenant-edit-wrapper">
                                <svg class="input-icon" width="16" height="16" viewBox="0 0 16 16" fill="none">
                                    <path
                                        d="M2 6L8 2L14 6V13C14 13.5304 13.7893 14.0391 13.4142 14.4142C13.0391 14.7893 12.5304 15 12 15H4C3.46957 15 2.96086 14.7893 2.58579 14.4142C2.21071 14.0391 2 13.5304 2 13V6Z"
                                        stroke="currentColor" stroke-width="1.5" stroke-linecap="round"
                                        stroke-linejoin="round" />
                                </svg>
                                <input type="text" class="form-input tenant-edit-input" [value]="tenantEditValue()"
                                    (input)="tenantEditValue.set($any($event.target).value); tenantErrorMessage.set('')"
                                    (keydown)="onTenantKeyDown($event)" placeholder="Enter school code"
                                    [disabled]="isValidatingTenant()" />
                            </div>
                            <button type="button" class="action-btn save-btn" (click)="onSaveTenant()"
                                [disabled]="!tenantEditValue().trim() || isValidatingTenant()" title="Save (Enter)">
                                @if (isValidatingTenant()) {
                                <svg class="spinner" width="14" height="14" viewBox="0 0 24 24" fill="none">
                                    <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="3"
                                        stroke-linecap="round" stroke-dasharray="31.4 31.4" stroke-dashoffset="0">
                                        <animateTransform attributeName="transform" type="rotate" from="0 12 12"
                                            to="360 12 12" dur="1s" repeatCount="indefinite" />
                                    </circle>
                                </svg>
                                } @else {
                                <svg width="14" height="14" viewBox="0 0 16 16" fill="none">
                                    <path d="M13.3333 4L6 11.3333L2.66666 8" stroke="currentColor" stroke-width="2"
                                        stroke-linecap="round" stroke-linejoin="round" />
                                </svg>
                                }
                            </button>
                            <button type="button" class="action-btn cancel-btn" (click)="onCancelTenantEdit()"
                                [disabled]="isValidatingTenant()" title="Cancel (Esc)">
                                <svg width="14" height="14" viewBox="0 0 16 16" fill="none">
                                    <path d="M12 4L4 12M4 4L12 12" stroke="currentColor" stroke-width="2"
                                        stroke-linecap="round" stroke-linejoin="round" />
                                </svg>
                            </button>
                        </div>
                        @if (tenantErrorMessage()) {
                        <p class="tenant-error">{{ tenantErrorMessage() }}</p>
                        }
                    </div>
                    }
                </div>
                }
                } @else {
                <div class="host-hint" @stepFadeUp>
                    Host admins can sign in without selecting a school.
                </div>
                }

                @if (loginMode() === 'host' || tenantStep() === 'login') {
                <form (ngSubmit)="onSubmit()" class="login-form" @stepFadeUp>
                    <div class="form-group">
                        <label class="form-label">Email</label>
                        <div class="input-wrapper">
                            <svg class="input-icon" width="16" height="16" viewBox="0 0 16 16" fill="none">
                                <path
                                    d="M2.667 4h10.666c.737 0 1.334.597 1.334 1.333v5.334c0 .736-.597 1.333-1.334 1.333H2.667c-.736 0-1.333-.597-1.333-1.333V5.333c0-.736.597-1.333 1.333-1.333Z"
                                    stroke="currentColor" stroke-width="1.3" />
                                <path d="m2.667 5.333 5.333 3.334 5.333-3.334" stroke="currentColor"
                                    stroke-width="1.3" stroke-linecap="round" stroke-linejoin="round" />
                            </svg>
                            <input type="email" class="form-input" placeholder="principal@edumanage.com"
                                [value]="username()" (input)="username.set($any($event.target).value)" required />
                        </div>
                    </div>

                    <div class="form-group">
                        <div class="form-label-row">
                            <label class="form-label">Password</label>
                            <a class="link-btn" routerLink="/auth/forgot">Forgot password?</a>
                        </div>
                        <div class="input-wrapper">
                            <svg class="input-icon" width="16" height="16" viewBox="0 0 16 16" fill="none">
                                <path
                                    d="M12.6667 7.33333H3.33333C2.59695 7.33333 2 7.93029 2 8.66667V13.3333C2 14.0697 2.59695 14.6667 3.33333 14.6667H12.6667C13.403 14.6667 14 14.0697 14 13.3333V8.66667C14 7.93029 13.403 7.33333 12.6667 7.33333Z"
                                    stroke="currentColor" stroke-width="1.5" stroke-linecap="round"
                                    stroke-linejoin="round" />
                                <path
                                    d="M4.66675 7.33333V4.66667C4.66675 3.78261 5.01794 2.93477 5.64306 2.30964C6.26818 1.68452 7.11603 1.33333 8.00008 1.33333C8.88414 1.33333 9.73198 1.68452 10.3571 2.30964C10.9822 2.93477 11.3334 3.78261 11.3334 4.66667V7.33333"
                                    stroke="currentColor" stroke-width="1.5" stroke-linecap="round"
                                    stroke-linejoin="round" />
                            </svg>
                            <input [type]="showPassword() ? 'text' : 'password'" class="form-input"
                                placeholder="Enter your password" [value]="password()"
                                (input)="password.set($any($event.target).value)" required />
                            <button type="button" class="input-toggle" (click)="togglePassword()"
                                aria-label="Toggle password visibility">
                                <svg *ngIf="!showPassword()" width="16" height="16" viewBox="0 0 16 16" fill="none">
                                    <path
                                        d="M1.333 8c1.4-2.8 3.733-4.333 6.667-4.333S13.267 5.2 14.667 8c-1.4 2.8-3.733 4.333-6.667 4.333S2.733 10.8 1.333 8Z"
                                        stroke="currentColor" stroke-width="1.2" />
                                    <circle cx="8" cy="8" r="2.2" stroke="currentColor" stroke-width="1.2" />
                                </svg>
                                <svg *ngIf="showPassword()" width="16" height="16" viewBox="0 0 16 16" fill="none">
                                    <path d="M2 2l12 12" stroke="currentColor" stroke-width="1.2"
                                        stroke-linecap="round" />
                                    <path
                                        d="M3.2 4.1C1.9 5.2 1.067 6.6 1.333 8c1.4 2.8 3.733 4.333 6.667 4.333 1.06 0 2.04-.2 2.94-.6"
                                        stroke="currentColor" stroke-width="1.2" stroke-linecap="round" />
                                    <path d="M6.233 6.233A2.333 2.333 0 0 1 9.8 9.8" stroke="currentColor"
                                        stroke-width="1.2" />
                                </svg>
                            </button>
                        </div>
                    </div>

                    @if (errorMessage()) {
                    <div class="error-message">{{ errorMessage() }}</div>
                    }
                    @if (resetSuccess()) {
                    <div class="success-message">Password reset successfully. Please sign in.</div>
                    }

                    <div class="form-group remember-group">
                        <label class="checkbox-chip">
                            <input type="checkbox" class="checkbox-input" [checked]="rememberMe()"
                                (change)="rememberMe.set($any($event.target).checked)" />
                            <span class="chip-icon" aria-hidden="true">
                                <svg width="14" height="14" viewBox="0 0 16 16" fill="none">
                                    <path d="M13.3333 4L6 11.3333L2.66666 8" stroke="currentColor" stroke-width="2"
                                        stroke-linecap="round" stroke-linejoin="round" />
                                </svg>
                            </span>
                            <span class="checkbox-text">Remember me</span>
                        </label>
                    </div>

                    <button type="submit" class="signin-btn" [disabled]="isLoading()">
                        <span>{{ isLoading() ? 'Signing in...' : 'Sign in' }}</span>
                        <svg class="signin-chevron" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true">
                            <path d="M6 3.5 10.5 8 6 12.5" stroke="currentColor" stroke-width="1.6" fill="none"
                                stroke-linecap="round" stroke-linejoin="round" />
                        </svg>
                    </button>

                    <p class="form-footer">Don't have an account? Contact your administrator</p>
                </form>
                }

                <div class="legal-row">
                    <a href="#">Privacy Policy</a>
                    <span>â€¢</span>
                    <a href="#">Terms of Service</a>
                </div>
            </div>
        </div>
    </div>
</div>

@if (showRegistration()) {
<app-tenant-registration (cancelled)="onRegistrationCancelled()"
    (registered)="onRegistrationCompleted($event)"></app-tenant-registration>
}
