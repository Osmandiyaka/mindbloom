<div class="registration-overlay" role="dialog" aria-modal="true">
    <div class="registration-card">
        <header class="registration-header">
            <div>
                <p class="step-label">Step {{ currentStep() }} of 3</p>
                <h2>Create your organization</h2>
                <p class="step-subtitle">Set up your tenant and admin account to get started.</p>
            </div>
            <button type="button" class="close-button" (click)="onCancel()" aria-label="Close">
                &times;
            </button>
        </header>

        <div class="stepper">
            <div class="stepper__step" [class.stepper__step--active]="currentStep() >= 1">
                <span>1</span>
                <span>Organization</span>
            </div>
            <div class="stepper__step" [class.stepper__step--active]="currentStep() >= 2">
                <span>2</span>
                <span>Admin</span>
            </div>
            <div class="stepper__step" [class.stepper__step--active]="currentStep() >= 3">
                <span>3</span>
                <span>Verification</span>
            </div>
        </div>

        <div class="registration-body">
            @if (currentStep() === 1) {
            <div class="step-content">
                <mb-form-field label="Organization name" [controlId]="'org-name'">
                    <mb-input id="org-name" [value]="schoolName()" (valueChange)="schoolName.set($event)"></mb-input>
                </mb-form-field>

                <mb-form-field label="Country/Region" [controlId]="'org-country'">
                    <mb-input id="org-country" [value]="country()" (valueChange)="country.set($event)" placeholder="Country or region"></mb-input>
                </mb-form-field>

                <mb-form-field label="Time zone" [controlId]="'org-timezone'">
                    <mb-input id="org-timezone" [value]="timezone()" (valueChange)="timezone.set($event)" placeholder="Time zone"></mb-input>
                </mb-form-field>

                <mb-form-field
                    label="Tenant URL"
                    [controlId]="'org-tenant-url'"
                    [error]="codeStatus() === 'taken' || codeStatus() === 'error' ? codeStatusMessage() : ''"
                    hint="Use lowercase letters, numbers, and hyphens."
                >
                    <mb-input id="org-tenant-url" [value]="schoolCode()" (valueChange)="onSchoolCodeInput($event)"></mb-input>
                    <span mbSuffix class="code-status" [class.available]="codeStatus() === 'available'" [class.checking]="codeStatus() === 'checking'">
                        @if (codeStatus() === 'checking') { Checking }
                        @if (codeStatus() === 'available') { Available }
                    </span>
                </mb-form-field>

                <mb-form-field label="School type" [controlId]="'org-school-type'">
                    <mb-select id="org-school-type" [options]="schoolTypeOptions" [value]="schoolType()" (valueChange)="schoolType.set($event)"></mb-select>
                </mb-form-field>

                <mb-form-field label="Primary contact email" [controlId]="'org-contact-email'">
                    <mb-input id="org-contact-email" type="email" [value]="email()" (valueChange)="email.set($event)" placeholder="you@school.edu"></mb-input>
                </mb-form-field>
            </div>
            }

            @if (currentStep() === 2) {
            <div class="step-content">
                <mb-form-field label="Admin full name" [controlId]="'admin-name'">
                    <mb-input id="admin-name" [value]="adminName()" (valueChange)="adminName.set($event)"></mb-input>
                </mb-form-field>

                <mb-form-field label="Admin email" [controlId]="'admin-email'">
                    <mb-input id="admin-email" type="email" [value]="adminEmail()" (valueChange)="adminEmail.set($event)" placeholder="admin@school.edu"></mb-input>
                </mb-form-field>

                <mb-form-field label="Admin password" [controlId]="'admin-password'">
                    <mb-input id="admin-password" [type]="showAdminPassword() ? 'text' : 'password'" [value]="adminPassword()" (valueChange)="adminPassword.set($event)"></mb-input>
                    <span mbSuffix>
                        <button class="inline-button" type="button" (click)="toggleAdminPassword()">
                            {{ showAdminPassword() ? 'Hide' : 'Show' }}
                        </button>
                    </span>
                </mb-form-field>

                <mb-form-field label="Confirm password" [controlId]="'admin-password-confirm'">
                    <mb-input id="admin-password-confirm" [type]="showAdminConfirm() ? 'text' : 'password'" [value]="adminPasswordConfirm()" (valueChange)="adminPasswordConfirm.set($event)"></mb-input>
                    <span mbSuffix>
                        <button class="inline-button" type="button" (click)="toggleAdminConfirm()">
                            {{ showAdminConfirm() ? 'Hide' : 'Show' }}
                        </button>
                    </span>
                </mb-form-field>

                <div class="password-strength">
                    <span [class.pass]="meetsLength()">Min 8 chars</span>
                    <span [class.pass]="meetsUpper()">Uppercase</span>
                    <span [class.pass]="meetsNumberOrSymbol()">Number or symbol</span>
                    <span [class.pass]="adminPassword() === adminPasswordConfirm() && adminPassword().length > 0">Match</span>
                </div>
            </div>
            }

            @if (currentStep() === 3) {
            <div class="step-content">
                <mb-alert variant="info">
                    Weâ€™ll send a verification email to {{ adminEmail() || 'your admin email' }} to confirm ownership.
                </mb-alert>

                <mb-checkbox [checked]="acceptTerms()" (checkedChange)="acceptTerms.set($event)">
                    I agree to the Terms and Privacy Policy.
                </mb-checkbox>
            </div>
            }

            @if (errorMessage()) {
            <div class="registration-error">
                <mb-alert variant="danger">{{ errorMessage() }}</mb-alert>
            </div>
            }
        </div>

        <div class="registration-actions">
            <mb-button variant="tertiary" type="button" (click)="onCancel()" [disabled]="isRegistering()">Cancel</mb-button>
            @if (currentStep() > 1) {
            <mb-button variant="secondary" type="button" (click)="prevStep()" [disabled]="isRegistering()">Back</mb-button>
            }
            @if (currentStep() < 3) {
            <mb-button variant="primary" type="button" (click)="nextStep()" [disabled]="isRegistering()">Next</mb-button>
            } @else {
            <mb-button variant="primary" type="button" (click)="onSubmit()" [disabled]="isRegistering()">
                {{ isRegistering() ? 'Creating...' : 'Create organization' }}
            </mb-button>
            }
        </div>
    </div>
</div>
