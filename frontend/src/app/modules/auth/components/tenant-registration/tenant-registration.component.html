<div class="registration-card">
    <!-- Left Brand Panel -->
    <div class="brand-panel">
        <div class="brand-content">
            <h1 class="brand-title">MindBloom</h1>
            <p class="brand-subtitle">
                Register your school<br>
                and start managing today.
            </p>

            <div class="brand-illustration">
                <svg viewBox="0 0 200 160" xmlns="http://www.w3.org/2000/svg">
                    <!-- School building illustration -->
                    <g>
                        <!-- Main building -->
                        <rect x="40" y="60" width="120" height="80" fill="#10B981" rx="4" />

                        <!-- Roof -->
                        <path d="M 30 60 L 100 30 L 170 60 Z" fill="#059669" />

                        <!-- Windows row 1 -->
                        <rect x="55" y="75" width="18" height="18" fill="#6EE7B7" rx="2" />
                        <rect x="91" y="75" width="18" height="18" fill="#6EE7B7" rx="2" />
                        <rect x="127" y="75" width="18" height="18" fill="#6EE7B7" rx="2" />

                        <!-- Windows row 2 -->
                        <rect x="55" y="105" width="18" height="18" fill="#6EE7B7" rx="2" />
                        <rect x="91" y="105" width="18" height="18" fill="#6EE7B7" rx="2" />
                        <rect x="127" y="105" width="18" height="18" fill="#6EE7B7" rx="2" />

                        <!-- Door -->
                        <rect x="85" y="110" width="30" height="30" fill="#065F46" rx="2" />
                        <circle cx="108" cy="125" r="2" fill="#6EE7B7" />
                    </g>
                </svg>
            </div>
        </div>
    </div>

    <!-- Right Registration Panel -->
    <div class="registration-panel">
        <div class="header">
            <div>
                <p class="step-label">Step {{ currentStep() }} of 3</p>
                <div class="progress-indicator">
                    <div class="progress-fill" [style.width.%]="(currentStep() / 3) * 100"></div>
                </div>
                <h2 class="title">Register Your School</h2>
            </div>
            <button type="button" class="close-btn" (click)="onCancel()" title="Cancel">
                <svg width="20" height="20" viewBox="0 0 16 16" fill="none">
                    <path d="M12 4L4 12M4 4L12 12" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round" />
                </svg>
            </button>
        </div>

        <div class="registration-form">
            <!-- Step 1 -->
            @if (currentStep() === 1) {
            <div class="step-card">
                <h3 class="step-title">School Identity</h3>
                <div class="form-group">
                    <label class="form-label">School Name *</label>
                    <input type="text" class="form-input" placeholder="" [value]="schoolName()"
                        (input)="schoolName.set($any($event.target).value)" required />
                </div>

                <div class="form-group">
                    <label class="form-label with-inline">
                        <span>School Code *</span>
                        <span class="code-status" [class.success]="codeStatus() === 'available'"
                            [class.error]="codeStatus() === 'taken' || codeStatus() === 'error'">
                            @if (codeStatus() === 'checking') { Checking... }
                            @if (codeStatus() === 'available') { Available }
                            @if (codeStatus() === 'taken') { Unavailable }
                            @if (codeStatus() === 'error') { Could not verify }
                        </span>
                    </label>
                    <div class="code-input-row">
                        <div class="input-with-status">
                            <input type="text" class="form-input" placeholder="" [value]="schoolCode()"
                                (input)="onSchoolCodeInput($any($event.target).value)" required />
                            <span class="status-dot" [class.available]="codeStatus() === 'available'"
                                [class.taken]="codeStatus() === 'taken'"
                                [class.checking]="codeStatus() === 'checking'"></span>
                        </div>
                        <button type="button" class="generate-code-btn" (click)="generateSchoolCode()"
                            [disabled]="!schoolName().trim()"
                            [title]="schoolName().trim() ? 'Generate a code suggestion' : 'Enter a school name first'">
                            <span class="generate-code-icon" aria-hidden="true">
                                <svg width="16" height="16" viewBox="0 0 16 16" fill="none"
                                    xmlns="http://www.w3.org/2000/svg">
                                    <path d="M7.5 2.5 5.5 7h2.5L5.5 13.5 9 9.25H6.5L10.5 2.5H7.5Z" stroke="currentColor"
                                        stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round" />
                                </svg>
                            </span>
                            <span>Generate code</span>
                        </button>
                    </div>
                    <p class="form-help">This will be your unique identifier. Use lowercase letters, numbers, and
                        hyphens
                        only. You can generate suggestions based on the school name.</p>
                </div>

                <div class="form-group">
                    <label class="form-label">Primary Contact Email *</label>
                    <input type="email" class="form-input" placeholder="" [value]="email()"
                        (input)="email.set($any($event.target).value)" required />
                </div>
            </div>
            }

            <!-- Step 2 -->
            @if (currentStep() === 2) {
            <div class="step-card">
                <h3 class="step-title">Admin Credentials</h3>
                <div class="form-group">
                    <label class="form-label">Admin Full Name *</label>
                    <input type="text" class="form-input" placeholder="" [value]="adminName()"
                        (input)="adminName.set($any($event.target).value)" required />
                </div>

                <div class="form-group">
                    <label class="form-label">Admin Email *</label>
                    <input type="email" class="form-input" placeholder="" [value]="adminEmail()"
                        (input)="adminEmail.set($any($event.target).value)" required />
                </div>

                <div class="form-group two-column">
                    <div>
                        <label class="form-label">Admin Password *</label>
                        <input type="password" class="form-input" placeholder="" [value]="adminPassword()"
                            (input)="adminPassword.set($any($event.target).value)" required />
                    </div>
                    <div>
                        <label class="form-label">Confirm Password *</label>
                        <input type="password" class="form-input" placeholder="" [value]="adminPasswordConfirm()"
                            (input)="adminPasswordConfirm.set($any($event.target).value)" required />
                    </div>
                </div>

                <div class="password-strength">
                    <div class="strength-chip" [class.pass]="meetsLength()">Min 8 chars</div>
                    <div class="strength-chip" [class.pass]="meetsUpper()">Uppercase</div>
                    <div class="strength-chip" [class.pass]="meetsNumberOrSymbol()">Number or symbol</div>
                    <div class="strength-chip"
                        [class.pass]="adminPassword() === adminPasswordConfirm() && adminPassword().length > 0">Match
                    </div>
                </div>
            </div>
            }

            <!-- Step 3 -->
            @if (currentStep() === 3) {
            <div class="step-card">
                <h3 class="step-title">Edition & Confirmation</h3>
                <div class="form-group">
                    <label class="form-label">Select Edition</label>
                    <div class="plan-cards">
                        @if (loadingEditions()) {
                        <div>Loading editions...</div>
                        } @else if (editionLoadError()) {
                        <div class="error-message">{{ editionLoadError() }}</div>
                        } @else {
                        <ng-container *ngFor="let e of editions()">
                            <div class="plan-card" [class.selected]="selectedEdition() === e.name"
                                (click)="selectEdition(e.name)">
                                <div class="plan-header">
                                    <div class="plan-name">{{ e.displayName }}</div>
                                </div>
                                <div class="plan-price">{{ e.monthlyPrice ? ('$' + e.monthlyPrice + '/month') :
                                    (e.perStudentMonthly ? ('$' + e.perStudentMonthly + '/student/mo') : (e.annualPrice
                                    ? ('$' + e.annualPrice + '/yr') : (e.annualPriceNotes || 'Talk to us')) ) }}</div>
                                <ul class="plan-features">
                                    <li *ngFor="let f of featureKeys(e.features)">{{ f.replace('_', ' ') }}</li>
                                </ul>
                            </div>
                        </ng-container>
                        }
                    </div>
                </div>

                <div class="terms-row">
                    <label class="chip-toggle">
                        <input type="checkbox" [checked]="acceptTerms()"
                            (change)="acceptTerms.set($any($event.target).checked)" />
                        <span class="checkbox-visual"></span>
                        <span class="chip-label">I agree to the Terms & Privacy</span>
                    </label>
                </div>
            </div>
            }

            <!-- Error Message -->
            @if (errorMessage()) {
            <div class="error-message">{{ errorMessage() }}</div>
            }

            <!-- Action Buttons -->
            <div class="action-buttons">
                <button type="button" class="cancel-action-btn" (click)="onCancel()" [disabled]="isRegistering()">
                    Cancel
                </button>
                @if (currentStep() > 1) {
                <button type="button" class="ghost-btn" (click)="prevStep()" [disabled]="isRegistering()">
                    Back
                </button>
                }
                @if (currentStep() < 3) { <button type="button" class="register-btn" (click)="nextStep()"
                    [disabled]="isRegistering()">
                    Next
                    </button>
                    } @else {
                    <button type="button" class="register-btn" (click)="onSubmit()" [disabled]="isRegistering()">
                        {{ isRegistering() ? 'Registering...' : 'Register School' }}
                    </button>
                    }
            </div>
        </div>
    </div>
</div>