<div class="tenant-selector">
    <mb-form-field
        label="Organization"
        [controlId]="'tenant-search'"
        hint="Search by school name, tenant code, or domain."
        [error]="errorMessage()"
    >
        <span mbPrefix class="tenant-selector__prefix" aria-hidden="true">
            <svg viewBox="0 0 24 24" role="presentation">
                <path
                    d="M11 3a8 8 0 105.29 14.29l3.7 3.7 1.41-1.41-3.7-3.7A8 8 0 0011 3zm0 2a6 6 0 11-4.24 10.24A6 6 0 0111 5z"
                    fill="currentColor"
                />
            </svg>
        </span>
        <mb-input
            id="tenant-search"
            [value]="query()"
            (valueChange)="onQueryChange($event)"
            (keydown)="onKeyDown($event)"
            [disabled]="isLoading() || isResolving()"
            ariaLabel="Search for your organization"
        ></mb-input>
        <span mbSuffix class="tenant-selector__suffix" aria-hidden="true">
            @if (isLoading() || isResolving()) {
            <span class="tenant-selector__spinner"></span>
            }
        </span>
    </mb-form-field>

    @if (hasSearched()) {
    <div class="tenant-selector__panel" role="listbox" [attr.aria-busy]="isLoading() || isResolving()">
        @if (results().length) {
        <div class="tenant-selector__list">
            @for (tenant of results(); track tenant.id) {
            <button
                type="button"
                class="tenant-selector__option"
                [class.is-active]="activeIndex() === $index"
                (mouseenter)="activeIndex.set($index)"
                (click)="selectTenant(tenant)"
                role="option"
                [attr.aria-selected]="activeIndex() === $index"
                [disabled]="isResolving()"
            >
                <span class="tenant-selector__option-icon" aria-hidden="true">
                    <svg viewBox="0 0 24 24" role="presentation">
                        <path
                            d="M4 20h16v-2H4v2zm1-4h2v-3H5v3zm0-5h2V8H5v3zm0-5h2V3H5v3zm4 10h2v-3H9v3zm0-5h2V8H9v3zm0-5h2V3H9v3zm4 10h2v-3h-2v3zm0-5h2V8h-2v3zm0-5h2V3h-2v3zm4 10h2v-3h-2v3zm0-5h2V8h-2v3zm0-5h2V3h-2v3z"
                            fill="currentColor"
                        />
                    </svg>
                </span>
                <span class="tenant-selector__option-body">
                    <span class="tenant-selector__option-title">{{ tenant.name }}</span>
                    <span class="tenant-selector__option-meta">
                        <span class="tenant-selector__meta-item">
                            <svg viewBox="0 0 24 24" role="presentation" aria-hidden="true">
                                <path d="M3 10h18v4H3z" fill="currentColor" />
                                <path d="M5 7h14v2H5zM5 15h14v2H5z" fill="currentColor" />
                            </svg>
                            {{ tenant.subdomain }}.mindbloom.com
                        </span>
                        @if (tenant.customDomain) {
                        <span class="tenant-selector__meta-item">
                            <svg viewBox="0 0 24 24" role="presentation" aria-hidden="true">
                                <path d="M12 2a10 10 0 100 20 10 10 0 000-20zm0 2a8 8 0 017.75 6H4.25A8 8 0 0112 4zm-7.75 8h15.5A8 8 0 0112 20a8 8 0 01-7.75-8z" fill="currentColor" />
                            </svg>
                            {{ tenant.customDomain }}
                        </span>
                        }
                    </span>
                </span>
            </button>
            }
        </div>
        } @else {
        <div class="tenant-selector__empty">
            <p>No organizations found. Try a different name or tenant code.</p>
        </div>
        }
    </div>
    }
</div>
