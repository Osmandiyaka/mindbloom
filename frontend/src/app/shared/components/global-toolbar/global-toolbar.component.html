<div class="global-toolbar" role="banner">
    <div class="toolbar-left">
        <ng-container *ngIf="isMobile; else desktopToggle">
            <button type="button" class="toolbar-btn toggle-btn hamburger-btn" (click)="onNavToggle()"
                [attr.aria-controls]="'app-sidebar'" [attr.aria-expanded]="navOpen"
                [attr.aria-label]="navOpen ? 'Close navigation' : 'Open navigation'">
                <span class="hamburger" [class.open]="navOpen">
                    <span></span><span></span><span></span>
                </span>
            </button>
        </ng-container>
        <ng-template #desktopToggle>
            <button type="button" class="toolbar-btn toggle-btn chevron-btn" (click)="onNavToggle()"
                [appTooltip]="collapsed ? 'Expand navigation' : 'Collapse navigation'" tooltipPosition="bottom"
                [attr.aria-controls]="'app-sidebar'" [attr.aria-expanded]="!collapsed"
                [attr.aria-label]="collapsed ? 'Open navigation' : 'Close navigation'">
                <span class="chevron" aria-hidden="true">{{ collapsed ? '›' : '‹' }}</span>
            </button>
        </ng-template>

        <!-- School Selector -->
        @if (availableSchools().length > 1) {
        <div class="school-switcher hide-xs" appClickOutside (clickOutside)="closeSchoolMenu()">
            <button type="button" class="school-button" (click)="toggleSchoolMenu()" [appTooltip]="'Switch school'"
                tooltipPosition="bottom" [attr.aria-expanded]="schoolMenuOpen()">
                <span class="context-dot" aria-hidden="true"></span>
                <span class="context-prefix">School ·</span>
                <span class="context-text">{{ schoolName() }}</span>
                <span class="chevron-down" aria-hidden="true">▼</span>
            </button>

            @if (schoolMenuOpen()) {
            <div class="school-menu" (click)="$event.stopPropagation()">
                <div class="school-menu-header">Switch School</div>
                <div class="school-menu-search">
                    <span class="search-icon" aria-hidden="true" [innerHTML]="icon('search')"></span>
                    <input type="search" class="school-search-input" placeholder="Search schools..."
                        [ngModel]="schoolSearch()" (ngModelChange)="schoolSearch.set($event)" />
                </div>
                <div class="school-menu-list">
                    @for (school of filteredSchools(); track school.id) {
                    <button type="button" class="school-menu-item" [class.active]="isActiveSchool(school.id)"
                        [disabled]="isSchoolLoading()" (click)="switchSchool(school)">
                        <div class="school-item-content">
                            <div class="school-item-name">{{ school.name }}</div>
                            @if (school.code || school.domain) {
                            <div class="school-item-slug">{{ school.code || school.domain }}</div>
                            }
                        </div>
                        @if (isActiveSchool(school.id)) {
                        <span class="check-icon">✓</span>
                        }
                    </button>
                    }
                    @if (!filteredSchools().length) {
                    <div class="school-menu-empty">No schools match your search.</div>
                    }
                </div>
                <div class="school-menu-footer">
                    @if (canManageSchools()) {
                    <a class="school-manage-link" routerLink="/setup/school-settings">Manage schools</a>
                    }
                </div>
            </div>
            }
        </div>
        } @else {
        <div class="context-label hide-xs" [attr.title]="schoolName()">
            <span class="context-dot" aria-hidden="true"></span>
            <span class="context-prefix">School ·</span>
            <span class="context-text">{{ schoolName() }}</span>
        </div>
        }
    </div>

    <div class="toolbar-center">
        <button type="button" class="toolbar-btn search-trigger show-xs" (click)="toggleSearch()"
            [attr.aria-expanded]="searchExpanded" aria-label="Toggle search">
            <span class="icon" [innerHTML]="icon('search')"></span>
        </button>
        <div class="search-shell" [class.collapsed]="isMobile && !searchExpanded">
            <app-search-input class="search-container" placeholder="Search..."
                (search)="onSearch($event)"></app-search-input>
        </div>
    </div>

    <div class="toolbar-right">
        <button type="button" class="toolbar-btn" (click)="onNotificationsClick()" [appTooltip]="'Notifications'"
            tooltipPosition="bottom" aria-label="Notifications">
            <span class="icon" [innerHTML]="icon('alarm')"></span>
        </button>

        <app-theme-selector />

        <button type="button" class="toolbar-btn hide-sm" (click)="onMessagesClick()" [appTooltip]="'Messages'"
            tooltipPosition="bottom" aria-label="Messages">
            <span class="icon" [innerHTML]="icon('inbox')"></span>
        </button>

        <div class="toolbar-divider hide-sm"></div>

        <button type="button" class="user-chip" (click)="onLogout()" [appTooltip]="'Logout'" tooltipPosition="bottom"
            aria-label="Logout">
            <span class="avatar-circle" [innerHTML]="icon('logout')"></span>
            <span class="user-name hide-sm">Logout</span>
        </button>
    </div>
</div>
