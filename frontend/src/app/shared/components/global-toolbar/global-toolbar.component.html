<div class="global-toolbar" role="banner">
    <div class="toolbar-left">
        <ng-container *ngIf="isMobile; else desktopToggle">
            <button type="button" class="toolbar-btn toggle-btn hamburger-btn" (click)="onNavToggle()"
                [attr.aria-controls]="'app-sidebar'" [attr.aria-expanded]="navOpen"
                [attr.aria-label]="navOpen ? 'Close navigation' : 'Open navigation'">
                <span class="hamburger" [class.open]="navOpen">
                    <span></span><span></span><span></span>
                </span>
            </button>
        </ng-container>
        <ng-template #desktopToggle>
            <button type="button" class="toolbar-btn toggle-btn chevron-btn" (click)="onNavToggle()"
                [appTooltip]="collapsed ? 'Expand navigation' : 'Collapse navigation'" tooltipPosition="bottom"
                [attr.aria-controls]="'app-sidebar'" [attr.aria-expanded]="!collapsed"
                [attr.aria-label]="collapsed ? 'Open navigation' : 'Close navigation'">
                <span class="chevron" aria-hidden="true">{{ collapsed ? '›' : '‹' }}</span>
            </button>
        </ng-template>

        <!-- Tenant Switcher -->
        @if (availableTenants().length > 1) {
        <div class="tenant-switcher hide-xs" appClickOutside (clickOutside)="closeTenantMenu()">
            <button type="button" class="tenant-button" (click)="toggleTenantMenu()" [appTooltip]="'Switch school'"
                tooltipPosition="bottom" [attr.aria-expanded]="tenantMenuOpen()">
                <span class="context-dot" aria-hidden="true"></span>
                <span class="context-text">{{ tenantName() }}</span>
                <span class="chevron-down" aria-hidden="true">▼</span>
            </button>

            @if (tenantMenuOpen()) {
            <div class="tenant-menu" (click)="$event.stopPropagation()">
                <div class="tenant-menu-header">Switch School</div>
                <div class="tenant-menu-list">
                    @for (tenant of availableTenants(); track tenant.tenantId) {
                    <button type="button" class="tenant-menu-item" [class.active]="isActiveTenant(tenant.tenantId)"
                        [disabled]="isSwitchingTenant()" (click)="switchTenant(tenant)">
                        <div class="tenant-item-content">
                            <div class="tenant-item-name">{{ tenant.tenantName }}</div>
                            <div class="tenant-item-slug">{{ tenant.tenantSlug }}</div>
                        </div>
                        @if (isActiveTenant(tenant.tenantId)) {
                        <span class="check-icon">✓</span>
                        }
                    </button>
                    }
                </div>
            </div>
            }
        </div>
        } @else {
        <div class="context-label hide-xs" [attr.title]="tenantName()">
            <span class="context-dot" aria-hidden="true"></span>
            <span class="context-text">{{ tenantName() }}</span>
        </div>
        }
    </div>

    <div class="toolbar-center">
        <button type="button" class="toolbar-btn search-trigger show-xs" (click)="toggleSearch()"
            [attr.aria-expanded]="searchExpanded" aria-label="Toggle search">
            <span class="icon" [innerHTML]="icon('search')"></span>
        </button>
        <div class="search-shell" [class.collapsed]="isMobile && !searchExpanded">
            <app-search-input class="search-container" placeholder="Search..."
                (search)="onSearch($event)"></app-search-input>
        </div>
    </div>

    <div class="toolbar-right">
        <button type="button" class="toolbar-btn" (click)="onNotificationsClick()" [appTooltip]="'Notifications'"
            tooltipPosition="bottom" aria-label="Notifications">
            <span class="icon" [innerHTML]="icon('alarm')"></span>
        </button>

        <app-theme-selector />

        <button type="button" class="toolbar-btn hide-sm" (click)="onMessagesClick()" [appTooltip]="'Messages'"
            tooltipPosition="bottom" aria-label="Messages">
            <span class="icon" [innerHTML]="icon('inbox')"></span>
        </button>

        <div class="toolbar-divider hide-sm"></div>

        <button type="button" class="user-chip" (click)="onLogout()" [appTooltip]="'Logout'" tooltipPosition="bottom"
            aria-label="Logout">
            <span class="avatar-circle" [innerHTML]="icon('logout')"></span>
            <span class="user-name hide-sm">Logout</span>
        </button>
    </div>
</div>